<script>
  const video = document.getElementById('kamera');
  const canvas = document.getElementById('overlay');
  const context = canvas.getContext('2d');
  const fotoBtn = document.getElementById('fotoBtn');
  const downloadLink = document.getElementById('downloadLink');

  let width = 640;
  let height = 480;

  async function startKamera() {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
      video.srcObject = stream;

      video.onloadedmetadata = () => {
        width = video.videoWidth;
        height = video.videoHeight;
        canvas.width = width;
        canvas.height = height;
      };
    } catch (err) {
      alert("Kamera gagal dibuka: " + err.message);
    }
  }

  async function startDeteksi() {
    await faceapi.nets.tinyFaceDetector.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js/models');
    await faceapi.nets.faceLandmark68TinyNet.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js/models');

    video.addEventListener('play', () => {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;

      const draw = async () => {
        const result = await faceapi
          .detectSingleFace(video, new faceapi.TinyFaceDetectorOptions())
          .withFaceLandmarks(true);

        context.clearRect(0, 0, canvas.width, canvas.height);

        if (result && result.landmarks) {
          const mouth = result.landmarks.getMouth();
          context.fillStyle = 'rgba(255, 50, 130, 0.5)';
          context.beginPath();
          context.moveTo(mouth[0].x, mouth[0].y);
          for (let i = 1; i < mouth.length; i++) {
            context.lineTo(mouth[i].x, mouth[i].y);
          }
          context.closePath();
          context.fill();
        }

        r
